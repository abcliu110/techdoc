<div id="chap-cr"></div>

[⬆️ 返回目录](#catalog)


## 回车换行

`\r\n` 的由来是一个典型的**“硬件遗留问题影响软件设计”**的案例。

它的历史可以追溯到**老式机械打字机（Typewriter）**时代，比计算机的出现要早得多。

我们可以把这个故事分为三个阶段：**机械时代**、**电传打字机时代**、**操作系统的大分裂**。

---

### 第一阶段：机械打字机时代 (The Mechanical Era)

在没有屏幕的时代，人们用打字机打字。当打完一行字想要换到下一行继续打时，需要做**两个独立的物理动作**：

1.  **Carriage Return (CR, 归位/回车)**：
    打字机的滚筒（承载纸张的部件，叫 Carriage）会随着打字向左移动。打完一行，必须把它**推回**最右边，这样打字头就会对准纸张的最左边。
    *   这个动作叫做 **Return**。
    *   对应转义字符：`\r` (ASCII 13)。

2.  **Line Feed (LF, 换行/进纸)**：
    光归位还不够，否则你会把新字重叠打印在旧字上面。你需要转动滚筒，把纸张**向上卷**一行。
    *   这个动作叫做 **Feed**。
    *   对应转义字符：`\n` (ASCII 10)。

**结论**：在物理世界里，**“回到行首”**和**“移到下一行”**是两个完全不同的机械操作，必须组合使用才能实现我们现在理解的“回车换行”。

---

### 第二阶段：电传打字机与计算机早期 (The Teletype Era)

计算机诞生初期，输入输出设备使用的是**电传打字机（Teletype, TTY）**（比如著名的 Model 33 ASR）。

早期的计算机非常慢，硬件也很笨。为了控制打印机，必须发送明确的指令：
*   如果只发 `\n`：打印头不动，纸上卷一行。结果变成了**“阶梯状”**文本：
    ```text
    第一行
          第二行
                第三行
    ```
*   如果只发 `\r`：纸不动，打印头回到行首。结果是**新内容覆盖旧内容**。

**还有一个关键的物理原因：**
机械归位（CR）动作比较慢，需要时间。如果归位还没完成就紧接着打印下一个字符，那个字就会印在纸张中间。
为了解决这个问题，当时的工程师决定：**必须发送两个字符 `\r` + `\n`**。
利用 `\n` 的执行时间（进纸动作比较快），正好填补 `\r`（归位动作比较慢）所需的物理时间缓冲。

---

### 第三阶段：操作系统的大分裂 (The Great Split)

到了计算机存储（磁带、软盘、内存）极其昂贵的年代，操作系统的设计者们开始产生分歧：**“为了换行，真的需要浪费 2 个字节来存储吗？”**

这时候，三大阵营做出了不同的选择，导致了今天程序员的痛苦：

#### 1. Unix / Linux 阵营 (包括现在的 macOS) —— **只用 `\n`**
*   **代表人物**：Ken Thompson, Dennis Ritchie (C语言和Unix之父)。
*   **理由**：存储太贵了！每行省 1 个字节就是巨大的胜利。
*   **逻辑**：他们在编写 Unix 时决定，在内存和存储中只用一个 `\n` (LF) 代表换行。只有当真正输出到打印机或终端时，驱动程序再负责把它“翻译”成 `\r\n`。
*   **现状**：这是目前服务器和开发环境的主流标准。

#### 2. Macintosh (老版麦金塔) 阵营 —— **只用 `\r`**
*   **代表人物**：Apple 早期团队。
*   **理由**：同样为了省空间。
*   **逻辑**：他们选择了只用 `\r` (CR)。
*   **现状**：MacOS X 之后，因为苹果转投 Unix 怀抱（基于 FreeBSD），所以现在苹果系统也变成了 `\n`。老版 Mac 格式几乎灭绝了。

#### 3. DOS / Windows 阵营 —— **坚持 `\r\n`**
*   **代表人物**：Bill Gates (微软)。
*   **理由**：**兼容性**。
*   **逻辑**：微软买下的 CP/M (DOS 的前身) 为了完美兼容当时的电传打字机和旧式外设，直接保留了 `\r\n`。Windows 继承了 DOS，于是也就继承了这个传统。
*   **现状**：Windows 的记事本曾长期无法正确显示 Unix 格式的文件（会显示成连在一起的一长串，中间夹杂着黑框框），直到 Windows 10 后期才修复这个问题。

---

### 总结与影响

| 操作系统 | 换行符 | 字节表示 (Hex) | 备注 |
| :--- | :--- | :--- | :--- |
| **Windows** | `\r\n` | `0D 0A` | 为了兼容古老的打印机硬件 |
| **Unix/Linux/macOS** | `\n` | `0A` | 为了节省昂贵的存储空间 |
| **Old Mac (Pre-X)** | `\r` | `0D` | 特立独行 (已淘汰) |

**为什么网络协议（如 HTTP）还要用 `\r\n`？**

你在 TCP/IP 协议或 HTTP 头部中看到规定必须使用 `\r\n` 结尾，这是因为互联网协议标准（RFC）制定时，深受当时各种异构系统的影响，为了**“最大公约数”**的兼容性以及**明确的边界划分**，采用了最保守、最原始的 `\r\n`。

这也是为什么你在写网络程序解析 HTTP 包时，经常需要处理 `\r\n`，而写本地 Python 脚本读文件时，往往只需要处理 `\n`。

<!-- 跳转链接 -->
[⬆️ 返回目录](#catalog)  |  [文章开头 ➡️](#chap-cr)