<div id="chap-iprouter"></div>

[⬆️ 返回目录](#catalog)


## IP Router

没问题，作为运维，长时间不碰底层命令确实容易生疏。`ip route` 是 `iproute2` 套件的核心命令，现在已经全面取代了老旧的 `route` 和 `netstat` 命令。

我们逐行来“解剖”这张路由表，这就好比查看物流中心的“分拣规则”。

---

### 第一行：默认路由 (Default Route) - "兜底规则"
```text
default via 192.168.80.2 dev ens33 proto static metric 100
```

这是最重要的一行，决定了你能不能上网。

*   **`default`**: 其实就是 `0.0.0.0/0` 的缩写。意思是：“**所有不知道该往哪发的包，统统走这条路**”。
*   **`via 192.168.80.2`**: **下一跳 (Next Hop)**。意思是把包交给 `192.168.80.2` 这个 IP。正如刚才我们分析的，这是 VMware NAT 模式下的**虚拟网关**。
*   **`dev ens33`**: 出口网卡。数据包要从 `ens33` 这个物理接口扔出去。
*   **`proto static`**: 协议来源是“静态”。这意味着这个网关是你（或者安装程序、NetworkManager）在配置文件里写死的，而不是 DHCP 动态获取的（如果是 DHCP 获取的，这里通常会显示 `proto dhcp`）。
*   **`metric 100`**: 跃点数/优先级。数字越小优先级越高。如果你连了两个网关（比如插了网线又连了 WiFi），系统会选 metric 小的那个走。

**人话总结**：*“只要不是发给局域网邻居的包，全部扔给 192.168.80.2 这个网关处理，让它帮忙转发到互联网。”*

---

### 第二行：本机直连网段 (Local Link) - "邻居规则"
```text
192.168.80.0/24 dev ens33 proto kernel scope link src 192.168.80.141 metric 100
```

这行定义了你所在的局域网如何通信。

*   **`192.168.80.0/24`**: 目的网段。意思是：“如果你的目标 IP 在 `192.168.80.1` 到 `192.168.80.254` 之间……”
*   **`dev ens33`**: ……就直接从 `ens33` 网卡发出去。
*   **`proto kernel`**: **这是重点**。这表示这条路由是**内核自动生成的**。当你给网卡配置了 IP 和掩码后，Linux 内核非常聪明，它知道：“哦，既然我在这个网段，那我访问这个网段的其他人肯定不需要经过网关，直接吼一声（ARP广播）就行了。”
*   **`scope link`**: 作用域是链路层。意思是目标就在这根网线上，不需要路由转发。
*   **`src 192.168.80.141`**: 源 IP。当发包给这个网段时，对方看到的你的 IP 是 `192.168.80.141`。

**人话总结**：*“如果我要找 192.168.80.x 的人，他们就在我家门口（ens33），我直接发给他们，不用麻烦网关。”*

---

### 第三行：虚拟化网桥 (Virtual Bridge) - "自家后院"
```text
192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1
```

这行通常出现在安装了 **KVM / Libvirt** 的 CentOS/RHEL 系统上。

*   **`virbr0`**: 这是一个虚拟网桥接口。当你安装 Linux 时如果选了“带虚拟化的服务器”，或者后来安装了 `libvirtd`，系统会自动创建这个网卡。
*   **`192.168.122.0/24`**: 这是 KVM 默认使用的 NAT 网段。
*   **`src 192.168.122.1`**: 你的这台机器，在那个虚拟网络里扮演了网关的角色（IP 是 .1）。

**人话总结**：*“这是给这台机器内部跑的 KVM 虚拟机准备的专用通道。如果你不跑虚拟机，这行路由其实是个摆设，可以忽略。”*

---

### 资深网管的“读表”逻辑

当我排查网络不通的问题时，我看这个表的顺序是倒过来的：

1.  **先看直连路由（proto kernel）**：确认 IP 配对了吗？掩码对了吗？如果没有这一行，说明网卡都没启起来。
2.  **再看默认路由（default）**：
    *   有没有 default 行？（没有就上不了外网）
    *   via 的地址对不对？（是不是 .2 ？）
    *   dev 接口对不对？
3.  **最后看 Metric**：如果有多条 default 路由，我会检查哪条 metric 更低，防止走错网卡（比如本来该走专线，结果走了外网）。

你的路由表非常标准、干净，是典型的 VMware NAT 模式下的状态。

你的感觉非常敏锐！这也是很多刚从 Windows 转到 Linux，或者从旧版 `netstat` 转到新版 `ip route` 的人最痛苦的地方。

**`ip route` 的输出确实不是“表格”，它是“叙述句”。**

旧时代的 `route -n` 或 `netstat -rn` 输出的是标准的 **Excel 表格**（有列头、对齐），而新时代的 `ip route` 输出的是 **Key-Value（键值对）式的长难句**。

为了方便记忆，你不要把它当表格看，要把它当成**英语里的“倒装句”或“指令行”**来看。

我给你一套**“万能句式模板”**，套进去你就瞬间看懂了。

---

### 万能句式：三段论

每一行路由，其实都遵循这个逻辑结构：

> **【去哪里】 + 【怎么走】 + 【附加参数】**

不管这行有多长，或者长得不一样，都是因为**“怎么走”**的方式不同导致的。

我们来看你截图里的两类典型句式：

#### 第一类：出远门的路由 (Default)
**特点**：必须经过网关，所以有 `via` 关键词。

*   **格式**：`[目标] via [网关IP] dev [网卡] ...`
*   **你的例子**：
    `default via 192.168.80.2 dev ens33 ...`
*   **翻译**：
    *   **去哪里**：`default` (全世界/外网)
    *   **怎么走**：`via 192.168.80.2` (经过 中介/网关)
    *   **出口**：`dev ens33` (从 ens33 门出去)

#### 第二类：就在家门口的路由 (Local Link)
**特点**：不需要网关，直接喊，所以**没有** `via`，但是有 `src`。

*   **格式**：`[目标网段] dev [网卡] ... src [本机IP]`
*   **你的例子**：
    `192.168.80.0/24 dev ens33 ... src 192.168.80.141`
*   **翻译**：
    *   **去哪里**：`192.168.80.0/24` (就在这层楼/局域网)
    *   **怎么走**：`dev ens33` (直接推开 ens33 这扇门)
    *   **我是谁**：`src 192.168.80.141` (对方看到我是 141)

---

### 记忆关键词 (Cheat Sheet)

把这 4 个单词背下来，你就能看懂所有路由表：

1.  **`via`** (经由)：
    *   看到它，说明**要出远门**，后面跟的一定是**路由器/网关**的 IP。
    *   *如果没有 via，说明是直连，不用求人。*

2.  **`dev`** (Device, 设备)：
    *   后面跟的一定是**你的网卡名字** (ens33, eth0)。
    *   意思是“从这个物理接口发出去”。

3.  **`src`** (Source, 源)：
    *   意思是“当我就在这条路上走的时候，我对外展示的 IP 是什么”。
    *   这主要用于多 IP 的机器，告诉对方回信给谁。

4.  **`metric`** (度量值/代价)：
    *   数字。
    *   意思是“路费”。如果去同一个地方有两条路，系统会选 metric 最小（最便宜）的那条。

---

### 实在受不了？资深网管的“怀旧大招”

如果你依然觉得 `ip route` 的长句很难看，虽然 `netstat` 和 `route` 命令已经被标记为“过时（Deprecated）”，但在 CentOS 7/8/9 里，它们依然能用（通常在 `net-tools` 包里）。

你可以输入这个命令，找回你熟悉的“表格感”：

```bash
route -n
```

出来的效果是这样的：

```text
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.80.2    0.0.0.0         UG    100    0        0 ens33
192.168.80.0    0.0.0.0         255.255.255.0   U     100    0        0 ens33
```

*   **Gateway 列**：如果是 `0.0.0.0`，就代表不需要网关（直连）；如果有 IP，就是网关。
*   **Flags 列**：`G` 代表 Gateway（网关），`U` 代表 Up（启动）。

**建议**：
虽然 `route -n` 看起来舒服，但作为未来的资深专家，我建议你还是逼自己习惯 `ip route`。因为 `ip route` 能显示更复杂的信息（比如策略路由、多路由表），而老表格 `route -n` 展示不出来那些高级特性。

**总结得非常精辟！一针见血。**

你这句话其实已经道出了路由表（Routing Table）的本质。作为资深网管，如果让我用最通俗的语言解释路由表，我也会这么说。

我们可以把你的这个总结拆解成 **“两个核心方向”**，这涵盖了 99% 的服务器通信场景：

---

### 1. 向内看：本地局域网如何访问 (LAN)
*   **对应你表中的**：`192.168.80.0/24 ... src 192.168.80.141`
*   **潜台词**：
    > “我要找的人就在这个屋子（网段）里。不用麻烦保安（网关），我直接走过去（直连）拍他肩膀就行。”
*   **技术原理**：
    *   **不查路由**：内核发现目标 IP 和自己在同一个网段。
    *   **发广播 (ARP)**：直接在网线/虚拟交换机上吼一声：“谁是 192.168.80.X？你的 MAC 地址是多少？”
    *   **直达**：拿到 MAC 地址后，直接把包扔给对方。

### 2. 向外看：广域网怎么样访问 (WAN)
*   **对应你表中的**：`default via 192.168.80.2`
*   **潜台词**：
    > “我要找的人不在屋子里（比如要去 Google 或百度）。我不知道他在哪，我只管把信交给门口的保安大爷（网关 .2），剩下的事大爷会搞定。”
*   **技术原理**：
    *   **查路由**：内核发现目标 IP 不在本地网段。
    *   **找下一跳**：匹配到 `default` 规则，决定把包扔给 `192.168.80.2`。
    *   **封装**：数据包的目标 IP 还是百度，但MAC地址写的是**网关的MAC**。

---

### 资深网管的“补充视角”

虽然你理解了“本地”和“外网”的区别，但作为一个管理员，看这张表时脑子里还要多想一层：

#### 1. 路由表是“地图”，不是“红绿灯”
这是很多新手最容易栽跟头的地方。
*   **路由表只管指路**：“去百度走这个门”。
*   **防火墙 (Firewall/iptables) 才是红绿灯**：“虽然你知道路怎么走，但我禁掉了你的 80 端口，所以你还是过不去。”
*   *排错提示*：如果你路由表没问题，但还是通不了，下一步一定要去查防火墙。

#### 2. 路由表只认“数字”，不认“名字”
*   路由表里全是 IP 地址（192.168...）。
*   它完全不知道 `www.baidu.com` 是谁。
*   **DNS (域名解析)** 是那个把“百度”变成“IP地址”的翻译官。翻译完之后，路由表才开始工作。
*   *排错提示*：如果你能 `ping 8.8.8.8` (通了，说明路由表和网关没问题)，但是 `ping www.google.com` 报错，那不是网络不通，是 DNS 坏了（比如 `/etc/resolv.conf` 没配好）。

### 总结
你的理解完全正确：
**路由表 = 本机的数据包导航仪。**
它告诉 Linux 内核：近处的邻居怎么找（直连），远处的陌生人怎么找（网关）。

<!-- 跳转链接 -->
[⬆️ 返回目录](#catalog)  |  [文章开头 ➡️](#chap-iprouter)