<div id="chap-urlencode"></div>

[⬆️ 返回目录](#catalog)


## urlencode

你提到的 **`unlencode`** 应该是笔误，实际上是指 **URL Encode**（正式名称为 **百分号编码 / Percent-Encoding**）。

它的核心作用是：**把任意字符转换成 URL 允许的安全 ASCII 字符格式**。

简单来说，它的技术原理就是**“中间商赚差价”**：把互联网不认识的“中文”拆解成互联网认识的“十六进制数字”。

以下是详细的技术原理和中文传递流程：

---

### 1. 技术原理：为什么需要它？

#### A. URL 的“洁癖” (ASCII 限制)
互联网标准（RFC 3986）规定，URL 只能包含 **US-ASCII** 字符集中的一部分。
*   **允许字符（白名单）**：`A-Z`，`a-z`，`0-9`，以及少数符号 `- _ . ~`。
*   **保留字符（有特殊用途）**：`/` (路径)，`?` (查询)，`&` (参数)，`=` (赋值) 等。
*   **非法字符**：
    *   **控制字符**：换行符、空格等。
    *   **非 ASCII 字符**：中文、日文、Emoji 表情等（因为 ASCII 只有 128 个，根本存不下汉字）。

#### B. 编码规则 (The Rule)
为了让那些“非法字符”能在 URL 中传输，URL Encode 采用了一套暴力转换规则：

1.  把字符转换成对应的 **字节序列 (Bytes)**。
2.  把每个字节转换成 **2位十六进制数 (Hex)**。
3.  在前面加上 **`%`** 作为标记。

> **公式**：`UrlEncode(Char) = "%" + Hex(Byte1) + "%" + Hex(Byte2) ...`

---

### 2. 为什么可以传递中文？ (核心流程)

中文之所以能传递，是因为 URL Encode 将“形状复杂”的汉字，打碎成了“底层二进制字节”，然后用 ASCII 字符描述出来。

这个过程依赖于字符集编码（通常是 **UTF-8**）。

#### 举例演示：汉字 “中” 的传输之旅

假设你在浏览器地址栏输入：`http://www.example.com/search?q=中`

**第一步：字符转字节 (Encoding)**
浏览器首先要把“中”字转换成计算机能理解的二进制。现在网络标准几乎统用 **UTF-8** 编码。
*   汉字：**中**
*   Unicode 码点：`U+4E2D`
*   **UTF-8 二进制**（汉字通常占 3 个字节）：
    `11100100`  `10111000`  `10101101`
*   对应十六进制：**`E4` `B8` `AD`**

**第二步：字节转百分号格式 (Percent-Encoding)**
将上面的 3 个十六进制数，分别加上 `%`。
*   结果：**`%E4%B8%AD`**

**第三步：传输**
浏览器实际发送给服务器的请求行是：
`GET /search?q=%E4%B8%AD HTTP/1.1`

> 注意：在这个请求里，所有的字符（%, E, 4, B, 8...）全都是合法的 ASCII 字符！网络设备传输毫无压力。

**第四步：服务器解码 (Decoding)**
服务器收到 `%E4%B8%AD` 后，识别到 `%`，知道这是编码后的数据。
1.  去掉 `%`，提取出 `E4`, `B8`, `AD`。
2.  按照 UTF-8 规则，将这 3 个字节合并。
3.  查表还原为汉字 **“中”**。

---

### 3. 一个常见的坑：GBK vs UTF-8

虽然原理一样，但如果两端使用的“字典”（字符集）不同，就会乱码。

*   **汉字“中”**：
    *   在 **UTF-8** 下是 3 字节：`%E4%B8%AD` (绝大多数现代网站)
    *   在 **GBK** (老式中文系统) 下是 2 字节：`%D6%D0`

**乱码是怎么产生的？**
如果浏览器用 UTF-8 发送了 `%E4%B8%AD`，但服务器错误的以为这是 GBK 编码：
*   服务器会把 `E4 B8` 解析成一个字（可能是乱码）。
*   把 `AD` 解析成另一个字（乱码）。
这就是为什么在进行 URL 编解码时，必须统一指定字符集（通常是 UTF-8）。

### 4. 总结

`urlencoded` 之所以能传递中文，不是因为它认识中文，而是因为它**把中文“粉碎”成了字节，再给每个字节穿上了一层“ASCII 的外衣”**（即 `%XY` 格式）。

*   **客户端**：中文 $\xrightarrow{UTF-8}$ 字节 $\xrightarrow{Hex}$ `%`字符串
*   **传输**：纯 ASCII 字符串（安全、兼容性好）
*   **服务端**：`%`字符串 $\xrightarrow{Hex}$ 字节 $\xrightarrow{UTF-8}$ 中文

<!-- 跳转链接 -->
[⬆️ 返回目录](#catalog)  |  [文章开头 ➡️](#chap-urlencode)