# 阿里云创建镜像仓库详细步骤

## 方式一：创建本地仓库（推荐，无需代码源）

### 步骤 1: 进入镜像仓库页面

1. 访问 https://cr.console.aliyun.com/
2. 点击左侧菜单 "镜像仓库"
3. 点击 "创建镜像仓库" 按钮

### 步骤 2: 填写基本信息

| 字段 | 填写内容 |
|------|---------|
| 命名空间 | 选择 `lgy-images` |
| 仓库名称 | `lgy-test` 或 `demo-springboot` |
| 仓库类型 | 公开（推荐）或 私有 |
| 摘要 | 测试镜像仓库 |

点击 "下一步"

### 步骤 3: 代码源（重要！）

**选择 "本地仓库"**

- ✅ 本地仓库（推荐）
- ❌ 不要选择 Codeup、GitHub 等代码源

点击 "创建镜像仓库"

### 步骤 4: 完成

创建成功后，你会看到仓库信息页面，包括：
- 仓库地址：`registry.cn-hangzhou.aliyuncs.com/lgy-images/lgy-test`
- 推送命令示例

## 方式二：通过推送自动创建（更简单）

阿里云支持首次推送时自动创建仓库。

### 前提条件

1. 命名空间已存在（`lgy-images` ✅）
2. 认证配置正确（Secret 已创建 ✅）

### 操作步骤

1. **不需要手动创建仓库**
2. 直接运行 Jenkins 流水线
3. 首次推送时，阿里云会自动创建仓库（默认为私有）

### 注意事项

- 自动创建的仓库默认是**私有**的
- 如果需要公开仓库，推送后需要手动修改仓库类型

## 验证仓库创建成功

创建完成后，在镜像仓库列表中应该能看到：

| 仓库名称 | 命名空间 | 仓库类型 | 创建时间 |
|---------|---------|---------|---------|
| lgy-test | lgy-images | 公开/私有 | 刚刚 |

## 推送测试

### 方式一：使用 Jenkins 流水线

运行 Jenkins 构建，勾选 "BUILD_DOCKER_IMAGE" 参数。

### 方式二：本地测试推送

```bash
# 1. 登录阿里云镜像仓库
docker login --username=你的用户名 registry.cn-hangzhou.aliyuncs.com

# 2. 构建测试镜像
docker build -t registry.cn-hangzhou.aliyuncs.com/lgy-images/lgy-test:v1 .

# 3. 推送镜像
docker push registry.cn-hangzhou.aliyuncs.com/lgy-images/lgy-test:v1
```

## 常见问题

### 1. 提示"源代码账户少代码仓库操作权限"

**原因**：选择了代码源（Codeup、GitHub 等）但没有授权

**解决**：选择 "本地仓库" 而不是代码源

### 2. 推送失败：repository does not exist

**原因**：仓库不存在

**解决**：
- 手动创建仓库
- 或者确保首次推送时阿里云会自动创建

### 3. 推送失败：DENIED

**原因**：认证失败或没有推送权限

**解决**：
- 检查 Secret 中的用户名和密码
- 确认用户有推送权限

### 4. 公开仓库 vs 私有仓库

**公开仓库**：
- ✅ 任何人都可以拉取镜像
- ✅ 推送需要认证
- ✅ 适合开源项目

**私有仓库**：
- ✅ 推送和拉取都需要认证
- ✅ 更安全
- ✅ 适合企业内部项目

## 推荐配置

对于测试项目，建议：
1. 创建**公开仓库**（方便测试）
2. 仓库名称：`lgy-test`
3. 代码源：选择 "本地仓库"

这样配置最简单，不需要额外的授权和配置！
