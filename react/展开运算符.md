<div id="chap-expand"></div>

[⬆️ 返回目录](#catalog)

## 展开运算符

在 React 和 JSX 中，`<Person {...p} />` 这种语法被称为 **“属性展开” (Spread Attributes)**。

虽然它看起来和 ES6 的对象展开（Object Spread）一模一样，但在 React 的这种场景下，它有几个非常特殊的点。以下是详细解析：

---

### 1. 它的本质是什么？

这是一种**快捷方式**。它的作用是将对象 `p` 的所有可枚举属性，拆解为单个的 `prop` 传递给组件。

**你的写法：**

```jsx
<Person {...p} />
```

**等价于：**

```jsx
<Person name={p.name} age={p.age} />
```

如果 `p` 对象里有 10 个字段，你不需要写 10 行，直接一行 `{...p}` 就能全部搞定。

---

### 2. 这里的 `...` 和原生 JS 的展开运算符一样吗？

这里存在一个**“语法保护”**的现象，非常微妙：

- **原生 JS 中：** 你不能在没有大括号的情况下直接展开一个对象。
  - `let obj2 = ...p;` // ❌ 报错，必须是 `{...p}`
  - `console.log(...p);` // ❌ 报错，对象不能像数组那样直接展开给函数参数
- **JSX 中：** React 和 Babel 专门为 JSX 标签内部做了定制。
  - 在 `<Component />` 标签内部，`{...p}` 是合法的语法。
  - **注意：** 必须带上**大括号**。这里的大括号不是对象的大括号，而是 JSX 解析 JavaScript 表达式的标志。

---

### 3. Babel 是如何转换它的？

当你写 `<Person {...p} />` 时，Babel（编译器）会将它转换成标准的 JavaScript 代码。

**转换后大致如下：**

```javascript
// 现代 React 转换 (React 17+)
import { jsx as _jsx } from "react/jsx-runtime";

_jsx(Person, { ...p });

// 或者是旧版的：
React.createElement(Person, Object.assign({}, p));
```

可以看到，底层其实是利用了 `Object.assign` 或 JavaScript 原生的对象展开。

---

### 4. 这种语法的几个关键细节

#### A. 覆盖效应（顺序很重要）

如果展开属性和其他属性同时存在，**后者会覆盖前者**。

- **场景 1：覆盖对象里的值**

  ```jsx
  // 如果 p = {name: "张三", age: 18}
  <Person {...p} age={20} />
  // 最终结果：age 是 20，因为 20 在后面。
  ```

- **场景 2：作为默认值**
  ```jsx
  <Person age={20} {...p} />
  // 最终结果：age 是 18，因为 p 里的 age 后出场，把 20 覆盖了。
  ```

#### B. 它的适用场景

- **透传 Props**：当你写一个高阶组件或包装组件，想把接收到的所有属性原封不动传给子组件时非常有用：
  ```javascript
  function LabelPerson(props) {
    return (
      <div className="wrapper">
        <Person {...props} />
      </div>
    );
  }
  ```

#### C. 警惕“属性污染”

虽然很方便，但要小心。如果你把一个巨大的对象 `...p` 传进去，而 `Person` 组件只用到了 `name`，那么剩下的属性（比如 `id`, `address`, `token` 等）也会被挂载到组件的 `props` 对象上。

- 这虽然不一定会报错，但可能会导致一些非法的 HTML 属性出现在 DOM 标签上（如果你直接展开到 `<div>` 等原生标签）。

---

### 总结

在你的代码里：

```javascript
p = { name: "张三", age: 18 };
ReactDOM.render(<Person {...p} />, ...);
```

这里的 `...p` 就是**把对象 `p` 里的 key-value 对，解构为 `name="张三"` 和 `age={18}` 传递给 `Person` 组件**。

这极大地方便了数据的批量传递，是 React 开发中最常用的语法糖之一。

在 React 和 JSX 中，`<Person {...p} />` 这种语法被称为 **“属性展开” (Spread Attributes)**。

虽然它看起来和 ES6 的对象展开（Object Spread）一模一样，但在 React 的这种场景下，它有几个非常特殊的点。以下是详细解析：

---

### 1. 它的本质是什么？

这是一种**快捷方式**。它的作用是将对象 `p` 的所有可枚举属性，拆解为单个的 `prop` 传递给组件。

**你的写法：**

```jsx
<Person {...p} />
```

**等价于：**

```jsx
<Person name={p.name} age={p.age} />
```

如果 `p` 对象里有 10 个字段，你不需要写 10 行，直接一行 `{...p}` 就能全部搞定。

---

### 2. 这里的 `...` 和原生 JS 的展开运算符一样吗？

这里存在一个**“语法保护”**的现象，非常微妙：

- **原生 JS 中：** 你不能在没有大括号的情况下直接展开一个对象。
  - `let obj2 = ...p;` // ❌ 报错，必须是 `{...p}`
  - `console.log(...p);` // ❌ 报错，对象不能像数组那样直接展开给函数参数
- **JSX 中：** React 和 Babel 专门为 JSX 标签内部做了定制。
  - 在 `<Component />` 标签内部，`{...p}` 是合法的语法。
  - **注意：** 必须带上**大括号**。这里的大括号不是对象的大括号，而是 JSX 解析 JavaScript 表达式的标志。

---

### 3. Babel 是如何转换它的？

当你写 `<Person {...p} />` 时，Babel（编译器）会将它转换成标准的 JavaScript 代码。

**转换后大致如下：**

```javascript
// 现代 React 转换 (React 17+)
import { jsx as _jsx } from "react/jsx-runtime";

_jsx(Person, { ...p });

// 或者是旧版的：
React.createElement(Person, Object.assign({}, p));
```

可以看到，底层其实是利用了 `Object.assign` 或 JavaScript 原生的对象展开。

---

### 4. 这种语法的几个关键细节

#### A. 覆盖效应（顺序很重要）

如果展开属性和其他属性同时存在，**后者会覆盖前者**。

- **场景 1：覆盖对象里的值**

  ```jsx
  // 如果 p = {name: "张三", age: 18}
  <Person {...p} age={20} />
  // 最终结果：age 是 20，因为 20 在后面。
  ```

- **场景 2：作为默认值**
  ```jsx
  <Person age={20} {...p} />
  // 最终结果：age 是 18，因为 p 里的 age 后出场，把 20 覆盖了。
  ```

#### B. 它的适用场景

- **透传 Props**：当你写一个高阶组件或包装组件，想把接收到的所有属性原封不动传给子组件时非常有用：
  ```javascript
  function LabelPerson(props) {
    return (
      <div className="wrapper">
        <Person {...props} />
      </div>
    );
  }
  ```

#### C. 警惕“属性污染”

虽然很方便，但要小心。如果你把一个巨大的对象 `...p` 传进去，而 `Person` 组件只用到了 `name`，那么剩下的属性（比如 `id`, `address`, `token` 等）也会被挂载到组件的 `props` 对象上。

- 这虽然不一定会报错，但可能会导致一些非法的 HTML 属性出现在 DOM 标签上（如果你直接展开到 `<div>` 等原生标签）。

---

### 总结

在你的代码里：

```javascript
p = { name: "张三", age: 18 };
ReactDOM.render(<Person {...p} />, ...);
```

这里的 `...p` 就是**把对象 `p` 里的 key-value 对，解构为 `name="张三"` 和 `age={18}` 传递给 `Person` 组件**。

这极大地方便了数据的批量传递，是 React 开发中最常用的语法糖之一。

<!-- 跳转链接 -->

[⬆️ 返回目录](#catalog) | [文章开头 ➡️](#chap-expand)
