<div id="chap-virtualdirectory"></div>

[⬆️ 返回目录](#catalog)


## 虚拟目录

Go 语言本身没有像 IIS 或 Apache 配置文件中那样现成的“虚拟目录”配置项，因为 Go 的服务器是**代码写出来的**，不是配置出来的。

但是，**你可以通过写代码来实现完全一样的功能**。

在 Go 中，实现“虚拟目录”（把 URL 的一段路径映射到硬盘的另一个文件夹）的核心技巧是组合使用 `http.FileServer` 和 **`http.StripPrefix`**。

### 1. 核心代码模式
假设你的需求是：
*   **虚拟目录（URL）**：用户访问 `http://localhost/static/`
*   **物理目录（硬盘）**：文件实际存放在项目根目录下的 `./public/` 文件夹中

**Go 代码这样写：**

```go
package main

import (
	"net/http"
)

func main() {
	// 1. 定义物理路径：告诉 Go 去硬盘的哪里找文件
	fileHandler := http.FileServer(http.Dir("./public"))

	// 2. 定义虚拟映射：
	// http.StripPrefix 的作用是：把 URL 里的 "/static/" 剪掉，再把剩下的传给 fileHandler
	http.Handle("/static/", http.StripPrefix("/static/", fileHandler))

	// 3. 启动服务器
	http.ListenAndServe(":8080", nil)
}
```

### 2. 为什么要用 `StripPrefix`？（关键点）

很多新手在 Go 里配置静态文件失败，都是因为没理解 `StripPrefix`（去除前缀）。

让我们模拟一下请求流程：

#### 场景 A：如果不加 StripPrefix（错误写法）
```go
http.Handle("/static/", http.FileServer(http.Dir("./public")))
```
1.  用户请求：`GET /static/cat.jpg`
2.  Go 路由匹配到 `/static/`。
3.  `FileServer` 拿着完整路径去硬盘找。
4.  **硬盘查找路径**：`./public/static/cat.jpg`
5.  **结果**：404 Not Found（因为你的 `./public` 下面没有 `static` 文件夹，只有 `cat.jpg`）。

#### 场景 B：加了 StripPrefix（正确写法）
```go
http.Handle("/static/", http.StripPrefix("/static/", http.FileServer(http.Dir("./public"))))
```
1.  用户请求：`GET /static/cat.jpg`
2.  Go 路由匹配到 `/static/`。
3.  **`StripPrefix` 介入**：它像把剪刀，把 URL 开头的 `/static/` 剪掉了。
4.  剩下的路径是：`cat.jpg`。
5.  `FileServer` 拿着剩下的路径去硬盘找。
6.  **硬盘查找路径**：`./public/cat.jpg`
7.  **结果**：成功找到文件！

### 3. 与 Nginx 的类比

如果你熟悉 Nginx，Go 的这两种写法正好对应 Nginx 的 `root` 和 `alias`：

| Go 的写法 | 类似 Nginx 的指令 | 行为描述 |
| :--- | :--- | :--- |
| **不加** StripPrefix | `root ./public;` | 把 URL **追加**到物理路径后面 |
| **加了** StripPrefix | `alias ./public/;` | 用物理路径 **替换** 掉 URL 的前缀 |

### 4. 如果用 Web 框架（如 Gin）

如果你觉得标准库的 `StripPrefix` 这种写法太绕了，Go 的 Web 框架通常会把这个功能封装得非常简单直观。

比如最流行的 **Gin** 框架，实现“虚拟目录”只需要一行代码：

```go
r := gin.Default()

// 语法：r.Static("虚拟路径", "物理路径")
r.Static("/static", "./public") 

r.Run(":8080")
```

**总结：**
Go 服务器没有“配置文件里的虚拟目录”，但它通过 **`http.StripPrefix` + `http.FileServer`** 这两个函数的组合，完美实现了虚拟目录的功能。这赋予了你更强的灵活性，你可以用代码控制任何复杂的路径映射逻辑。

<!-- 跳转链接 -->
[⬆️ 返回目录](#catalog)  |  [文章开头 ➡️](#chap-virtualdirectory)