<div id="chap-command"></div>

[⬆️ 返回目录](#catalog)

## 常用命令

```yaml
### 方案一：使用 `hostPort` （最推荐：平衡、安全、DNS 正常）

**原理**：Pod 保留独立的容器网络 IP，但宿主机内核在 `3306` 端口开了一个“后门”直通容器。
**优点**：笔记本能用 `192.168.1.114:3306`；Nacos 可以直接用 `mysql` 名称访问，**不会产生 DNS 混乱**。
#### MySQL 部署 (Deployment) 案例：
#### Nacos 配置建议：

- **无需开启 hostNetwork**。
- **环境变量**：`MYSQL_SERVICE_HOST` 填 **`mysql`** (对应的 Service 名)。
- **原理**：因为 MySQL 还在 K8s 内部网络，Nacos 作为一个标准 Pod，可以完美通过内部 DNS 找到它。

spec:
  template:
    spec:
      containers:
        - name: mysql
          image: mysql:8.0
          ports:
            - containerPort: 3306
              hostPort: 3306 # <--- 关键：将宿主机 3306 映射到容器 3306
              protocol: TCP
```

```yaml
### 方案二：使用 `hostNetwork` （高性能、但需修复 DNS）

**原理**：Pod 彻底放弃容器网络，直接占用宿主机的网卡。
**警告**：如果你给 Nacos 开启了 `hostNetwork`，它就再也认不出 `mysql` 这个名字了，除非你打“DNS 补丁”。

#### Nacos 部署 (Deployment) 案例：
如果你为了性能或特殊需求给 Nacos 开启了主机网络，请务必这样写：

spec:
  template:
    spec:
      hostNetwork: true
      # --- 关键补丁：解决你昨天遇到的“认不出 mysql 名字”的问题 ---
      dnsPolicy: ClusterFirstWithHostNet
      # -------------------------------------------------------
      containers:
        - name: nacos
          env:
            - name: MYSQL_SERVICE_HOST
              value: "mysql" # 现在可以认出这个名字了
            - name: MYSQL_SERVICE_PORT
              value: "3306" # 注意：引号内绝不能有空格
```

<!-- 跳转链接 -->

[⬆️ 返回目录](#catalog) | [文章开头 ➡️](#chap-command)
